<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student & Teacher Portal</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; } 
        .neon-glow { border: 1px solid #4f46e5; transition: all 0.3s ease-in-out; }
        .neon-glow:hover, .neon-glow:focus, .neon-glow:focus-within { box-shadow: 0 0 5px #4f46e5, 0 0 15px #4f46e5, 0 0 25px #4f46e5; }
        .btn-glow { border: 1px solid #4f46e5; box-shadow: 0 0 5px rgba(79, 70, 229, 0.5); transition: all 0.3s ease-in-out; }
        .btn-glow:hover { box-shadow: 0 0 8px #4f46e5, 0 0 20px #4f46e5; transform: translateY(-2px); }
        .typing-cursor::after { content: '|'; animation: blink 1s step-end infinite; }
        @keyframes blink { from, to { color: transparent } 50% { color: #4f46e5; } }
        .view { transition: opacity 0.5s ease-in-out; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6366f1; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen overflow-y-auto">

    <canvas id="particle-canvas" class="fixed top-0 left-0 w-full h-full z-0"></canvas>
    <div id="notification-container" class="fixed top-5 right-5 z-50 space-y-3"></div>

    <main id="app-container" class="relative z-10 min-h-screen flex flex-col items-center justify-center p-4">

        <!-- ===== VIEW: ROLE SELECTION ===== -->
        <div id="role-selection-view" class="view w-full max-w-md text-center">
            <h1 id="main-heading" class="text-5xl font-bold mb-12 text-white"></h1>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <button id="select-teacher-btn" class="p-8 bg-gray-800 rounded-lg neon-glow flex flex-col items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mb-3 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                    <span class="text-xl font-semibold">I am a Teacher</span>
                </button>
                <button id="select-student-btn" class="p-8 bg-gray-800 rounded-lg neon-glow flex flex-col items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mb-3 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M12 14l9-5-9-5-9 5 9 5z" /><path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-9.998 12.078 12.078 0 01.665-6.479L12 14z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-9.998 12.078 12.078 0 01.665-6.479L12 14z" /></svg>
                    <span class="text-xl font-semibold">I am a Student</span>
                </button>
            </div>
        </div>

        <!-- ===== VIEW: TEACHER AUTHENTICATION ===== -->
        <div id="teacher-auth-view" class="view hidden w-full max-w-md">
            <!-- Login Form -->
            <div id="teacher-login-form-container" class="bg-gray-800 p-8 rounded-lg neon-glow">
                <h2 class="text-3xl font-bold text-center mb-6">Teacher Login</h2>
                <form id="teacher-login-form">
                    <div class="mb-4">
                        <label for="teacher-login-email" class="block mb-2 text-sm font-medium">Email</label>
                        <input type="email" id="teacher-login-email" value="itdeptdav@gmail.com" disabled class="bg-gray-700 border border-gray-600 text-gray-300 text-sm rounded-lg block w-full p-2.5 cursor-not-allowed">
                    </div>
                    <div class="mb-6">
                        <label for="teacher-login-password" class="block mb-2 text-sm font-medium">Password</label>
                        <input type="password" id="teacher-login-password" required class="bg-gray-700 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5">
                    </div>
                    <button type="submit" class="w-full text-white bg-indigo-600 hover:bg-indigo-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center btn-glow flex items-center justify-center">
                        <span class="btn-text">Login</span>
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden btn-spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    </button>
                </form>
                <p class="text-sm text-center mt-4">Don't have an account? <a href="#" id="show-teacher-register" class="font-medium text-indigo-400 hover:underline">Register here</a></p>
                <p class="text-sm text-center mt-2"><a href="#" class="back-to-role-selection text-gray-400 hover:underline">Back to role selection</a></p>
            </div>
            <!-- Registration Form -->
            <div id="teacher-register-form-container" class="hidden bg-gray-800 p-8 rounded-lg neon-glow">
                 <h2 class="text-3xl font-bold text-center mb-6">Teacher Registration</h2>
                <form id="teacher-register-form">
                    <div class="mb-4">
                        <label for="teacher-register-email" class="block mb-2 text-sm font-medium">Email</label>
                        <input type="email" id="teacher-register-email" value="itdeptdav@gmail.com" disabled class="bg-gray-700 border border-gray-600 text-gray-300 text-sm rounded-lg block w-full p-2.5 cursor-not-allowed">
                    </div>
                    <div class="mb-4">
                        <label for="teacher-register-password" class="block mb-2 text-sm font-medium">Password</label>
                        <input type="password" id="teacher-register-password" required class="bg-gray-700 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5">
                    </div>
                    <button type="submit" class="w-full text-white bg-indigo-600 hover:bg-indigo-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center btn-glow flex items-center justify-center">
                        <span class="btn-text">Register</span>
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden btn-spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    </button>
                </form>
                <p class="text-sm text-center mt-4">Already have an account? <a href="#" id="show-teacher-login" class="font-medium text-indigo-400 hover:underline">Login here</a></p>
                <p class="text-sm text-center mt-2"><a href="#" class="back-to-role-selection text-gray-400 hover:underline">Back to role selection</a></p>
            </div>
        </div>
        
        <!-- ===== VIEW: STUDENT AUTHENTICATION ===== -->
        <div id="student-auth-view" class="view hidden w-full max-w-md">
            <!-- Login Form -->
            <div id="student-login-form-container" class="bg-gray-800 p-8 rounded-lg neon-glow">
                <h2 class="text-3xl font-bold text-center mb-6">Student Login</h2>
                <form id="student-login-form">
                    <div class="mb-4">
                        <label for="student-login-roll" class="block mb-2 text-sm font-medium">4-Digit Roll Number</label>
                        <input type="text" id="student-login-roll" pattern="\d{4}" title="Please enter a 4-digit roll number" required class="bg-gray-700 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5">
                    </div>
                    <div class="mb-6">
                        <label for="student-login-password" class="block mb-2 text-sm font-medium">Password</label>
                        <input type="password" id="student-login-password" required class="bg-gray-700 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5">
                    </div>
                    <button type="submit" class="w-full text-white bg-indigo-600 hover:bg-indigo-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center btn-glow flex items-center justify-center">
                        <span class="btn-text">Login</span>
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden btn-spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    </button>
                </form>
                <p class="text-sm text-center mt-4">Don't have an account? <a href="#" id="show-student-register" class="font-medium text-indigo-400 hover:underline">Register here</a></p>
                <p class="text-sm text-center mt-2"><a href="#" class="back-to-role-selection text-gray-400 hover:underline">Back to role selection</a></p>
            </div>
            <!-- Registration Form -->
            <div id="student-register-form-container" class="hidden bg-gray-800 p-8 rounded-lg neon-glow">
                <h2 class="text-3xl font-bold text-center mb-6">Student Registration</h2>
                <form id="student-register-form" class="space-y-4">
                    <input type="text" id="student-register-name" placeholder="Full Name" required class="bg-gray-700 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5">
                    <input type="text" id="student-register-roll" pattern="\d{4}" title="Must be a 4-digit number" placeholder="4-Digit Roll Number" required class="bg-gray-700 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5">
                    <div class="flex gap-4">
                        <select id="student-register-class" required class="bg-gray-700 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5">
                            <option value="">Select Class</option>
                            <option value="11">Class 11</option>
                            <option value="12">Class 12</option>
                        </select>
                        <select id="student-register-section" required class="bg-gray-700 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5">
                            <option value="">Select Section</option>
                            <option>A</option><option>A1</option><option>B</option><option>C</option><option>D</option><option>E</option><option>F</option><option>G</option><option>H</option><option>I</option><option>J</option>
                        </select>
                    </div>
                    <input type="password" id="student-register-password" placeholder="Password" required class="bg-gray-700 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5">
                    <button type="submit" class="w-full text-white bg-indigo-600 hover:bg-indigo-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center btn-glow flex items-center justify-center">
                        <span class="btn-text">Register</span>
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden btn-spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    </button>
                </form>
                <p class="text-sm text-center mt-4">Already have an account? <a href="#" id="show-student-login" class="font-medium text-indigo-400 hover:underline">Login here</a></p>
                <p class="text-sm text-center mt-2"><a href="#" class="back-to-role-selection text-gray-400 hover:underline">Back to role selection</a></p>
            </div>
        </div>

        <!-- ===== VIEW: STUDENT DASHBOARD ===== -->
        <div id="student-dashboard-view" class="view hidden w-full max-w-4xl text-center">
            <h1 id="student-welcome-message" class="text-4xl font-bold mb-4"></h1>
            <p id="student-status-message" class="text-xl p-4 rounded-lg"></p>
            <button id="student-logout-btn" class="mt-8 text-white bg-red-600 hover:bg-red-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center btn-glow" style="border-color: #dc2626;">Logout</button>
        </div>

        <!-- ===== VIEW: TEACHER DASHBOARD ===== -->
        <div id="teacher-dashboard-view" class="view hidden w-full h-screen flex flex-col p-0 m-0">
             <header class="bg-gray-800/50 backdrop-blur-sm w-full p-4 flex justify-between items-center border-b border-gray-700">
                <h1 class="text-2xl font-bold">Teacher Dashboard</h1>
                <nav id="teacher-main-nav" class="flex items-center space-x-4">
                    <button data-content="teacher-home-content" class="nav-btn px-4 py-2 rounded-md text-sm font-medium transition active">Home</button>
                    <button data-content="teacher-classes-content" class="nav-btn px-4 py-2 rounded-md text-sm font-medium transition">Classes</button>
                    <button data-content="teacher-top-students-content" class="nav-btn px-4 py-2 rounded-md text-sm font-medium transition">Top Students</button>
                    <button id="teacher-logout-btn" class="ml-4 text-white bg-red-600 hover:bg-red-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center btn-glow" style="border-color: #dc2626;">Logout</button>
                </nav>
            </header>
            <main class="flex-grow p-6 overflow-y-auto">
                <!-- Home Content -->
                <div id="teacher-home-content" class="teacher-content">
                    <h2 class="text-3xl font-semibold">Welcome, Teacher!</h2>
                    <p class="text-gray-400 mt-2">Select a tab from the navigation to manage classes or view student analytics.</p>
                </div>
                <!-- Top Students Content -->
                <div id="teacher-top-students-content" class="teacher-content hidden">
                    <h2 class="text-3xl font-semibold">Top Students</h2>
                    <p class="text-gray-400 mt-2">This feature is under development.</p>
                </div>
                <!-- Classes Content (Multi-level) -->
                <div id="teacher-classes-content" class="teacher-content hidden">
                    <!-- Level 1: Class Selection -->
                    <div id="class-selection-level">
                        <h2 class="text-3xl font-semibold mb-6">Select a Class</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div id="select-class-11" class="class-card bg-gray-800 p-8 rounded-lg neon-glow cursor-pointer relative">
                                <h3 class="text-4xl font-bold">Class 11</h3>
                                <div id="class-11-unverified-count" class="absolute top-3 right-3 bg-red-600 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center hidden">0</div>
                            </div>
                            <div id="select-class-12" class="class-card bg-gray-800 p-8 rounded-lg neon-glow cursor-pointer relative">
                                <h3 class="text-4xl font-bold">Class 12</h3>
                                <div id="class-12-unverified-count" class="absolute top-3 right-3 bg-red-600 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center hidden">0</div>
                            </div>
                        </div>
                    </div>
                    <!-- Level 2: Section Selection -->
                    <div id="section-selection-level" class="hidden">
                         <button id="back-to-class-selection" class="mb-6 text-indigo-400 hover:underline">&larr; Back to Class Selection</button>
                         <h2 id="section-level-title" class="text-3xl font-semibold mb-6"></h2>
                         <div id="section-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                             <!-- Section cards will be injected here -->
                         </div>
                    </div>
                    <!-- Level 3: Student Management -->
                    <div id="student-management-level" class="hidden">
                        <button id="back-to-section-selection" class="mb-4 text-indigo-400 hover:underline">&larr; Back to Section Selection</button>
                        <h2 id="student-level-title" class="text-3xl font-semibold mb-4"></h2>
                        <div class="border-b border-gray-700 mb-4">
                            <nav id="student-status-nav" class="-mb-px flex space-x-8" aria-label="Tabs">
                                <!-- Tabs will be injected here -->
                            </nav>
                        </div>
                        <div id="student-lists-container">
                           <!-- Student lists (unverified, verified, rejected) will be injected here -->
                        </div>
                    </div>
                </div>
            </main>
        </div>

    </main>
    
    <!-- ===== MODALS ===== -->
    <div id="roll-range-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 p-8 rounded-lg neon-glow w-full max-w-md">
            <h2 id="roll-range-modal-title" class="text-2xl font-bold mb-6"></h2>
            <form id="roll-range-form">
                <input type="hidden" id="modal-class">
                <input type="hidden" id="modal-section">
                <div class="mb-4">
                    <label for="start-roll" class="block mb-2 text-sm font-medium">Start Roll Number</label>
                    <input type="number" id="start-roll" required class="bg-gray-700 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5">
                </div>
                <div class="mb-6">
                    <label for="end-roll" class="block mb-2 text-sm font-medium">End Roll Number</label>
                    <input type="number" id="end-roll" required class="bg-gray-700 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5">
                </div>
                <div class="flex justify-end gap-4">
                    <button type="button" id="cancel-roll-range" class="px-5 py-2.5 text-sm font-medium text-gray-400 bg-transparent hover:bg-gray-700 rounded-lg">Cancel</button>
                    <button type="submit" class="text-white bg-indigo-600 hover:bg-indigo-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center btn-glow flex items-center justify-center">
                         <span class="btn-text">Save Range</span>
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden btn-spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    </button>
                </div>
            </form>
        </div>
    </div>
    <div id="student-analytics-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 p-8 rounded-lg neon-glow w-full max-w-lg relative">
            <button id="close-analytics-modal" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <div class="text-center">
                <h2 id="analytics-student-name" class="text-3xl font-bold"></h2>
                <p id="analytics-student-roll" class="text-gray-400 mb-6"></p>
            </div>
            <div class="flex flex-col md:flex-row items-center gap-8">
                <div class="relative w-40 h-40">
                    <svg class="w-full h-full" viewBox="0 0 36 36">
                        <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#ef4444" stroke-width="3" />
                        <path id="analytics-graph-gained" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#22c55e" stroke-width="3" stroke-dasharray="75, 100" stroke-linecap="round" />
                    </svg>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                         <span id="analytics-net-score-percent" class="text-3xl font-bold"></span>
                         <span class="text-sm text-gray-400">Net Score</span>
                    </div>
                </div>
                <div class="flex-1 grid grid-cols-2 gap-4 text-center">
                    <div class="bg-gray-700 p-3 rounded-lg"><p class="text-sm text-gray-400">Quizzes Given</p><p id="analytics-quizzes" class="text-2xl font-semibold"></p></div>
                    <div class="bg-gray-700 p-3 rounded-lg"><p class="text-sm text-green-400">Marks Gained</p><p id="analytics-gained" class="text-2xl font-semibold text-green-400"></p></div>
                    <div class="bg-gray-700 p-3 rounded-lg"><p class="text-sm text-red-400">Marks Deducted</p><p id="analytics-deducted" class="text-2xl font-semibold text-red-400"></p></div>
                    <div class="bg-gray-700 p-3 rounded-lg"><p class="text-sm text-indigo-400">Performance</p><p id="analytics-rating" class="text-2xl font-semibold text-indigo-400"></p></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
      import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
      import { getFirestore, collection, doc, setDoc, getDoc, getDocs, updateDoc, deleteDoc, query, where, onSnapshot, writeBatch } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBYvgxs984lC-Zg1wxeBKHuGDW04IzfdfU",
        authDomain: "test-project-error-fix.firebaseapp.com",
        projectId: "test-project-error-fix",
        storageBucket: "test-project-error-fix.firebasestorage.app",
        messagingSenderId: "1034119237308",
        appId: "1:1034119237308:web:2bbe637edf026e54ed4ab9",
        measurementId: "G-FFZZLCLC33"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      const views = document.querySelectorAll('.view');
      let currentTeacherClass = null;
      let currentTeacherSection = null;
      let unsubscribeListeners = [];

      function renderView(viewId) {
          views.forEach(view => {
              view.classList.toggle('hidden', view.id !== viewId);
              view.classList.toggle('opacity-0', view.id !== viewId);
          });
          setTimeout(() => {
              const activeView = document.getElementById(viewId);
              if(activeView) activeView.classList.remove('opacity-0');
          }, 50);
      }
      
      function showNotification(message, type = 'success') {
          const container = document.getElementById('notification-container');
          const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
          const notification = document.createElement('div');
          notification.className = `p-4 rounded-lg text-white ${bgColor} shadow-lg animate-pulse`;
          notification.textContent = message;
          container.appendChild(notification);
          setTimeout(() => {
              notification.style.transition = 'opacity 0.5s';
              notification.style.opacity = '0';
              setTimeout(() => notification.remove(), 500);
          }, 3000);
      }

      function toggleButtonSpinner(form, show) {
          const button = form.querySelector('button[type="submit"]');
          if (!button) return;
          const text = button.querySelector('.btn-text');
          const spinner = button.querySelector('.btn-spinner');
          if (show) {
              button.disabled = true;
              text.classList.add('hidden');
              spinner.classList.remove('hidden');
          } else {
              button.disabled = false;
              text.classList.remove('hidden');
              spinner.classList.add('hidden');
          }
      }
      
      function cleanupListeners() {
          unsubscribeListeners.forEach(unsub => unsub());
          unsubscribeListeners = [];
      }

      function typeEffect(element, text, speed = 100) {
          let i = 0;
          element.innerHTML = "";
          element.classList.add('typing-cursor');
          function type() {
              if (i < text.length) {
                  element.innerHTML += text.charAt(i);
                  i++;
                  setTimeout(type, speed);
              } else {
                 element.classList.remove('typing-cursor');
              }
          }
          type();
      }
      function runParticleAnimation() {
          const canvas = document.getElementById('particle-canvas');
          if (!canvas) return;
          const ctx = canvas.getContext('2d');
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
          let particles = [];
          const numParticles = Math.floor((canvas.width * canvas.height) / 15000);
          class Particle {
              constructor() { this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height; this.size = Math.random() * 2 + 1; this.speedX = Math.random() * 1 - 0.5; this.speedY = Math.random() * 1 - 0.5; }
              update() { this.x += this.speedX; this.y += this.speedY; if (this.x > canvas.width || this.x < 0) this.speedX *= -1; if (this.y > canvas.height || this.y < 0) this.speedY *= -1; }
              draw() { ctx.fillStyle = 'rgba(79, 70, 229, 0.5)'; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); }
          }
          function init() { for (let i = 0; i < numParticles; i++) { particles.push(new Particle()); } }
          function animate() { ctx.clearRect(0, 0, canvas.width, canvas.height); for (let i = 0; i < particles.length; i++) { particles[i].update(); particles[i].draw(); } requestAnimationFrame(animate); }
          init(); animate();
          window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; particles = []; init(); });
      }

      // --- AUTHENTICATION LOGIC ---
      onAuthStateChanged(auth, async (user) => {
          cleanupListeners();
          if (user) {
              const email = user.email;
              if (email === 'itdeptdav@gmail.com') { renderTeacherDashboard(); } 
              else if (email.endsWith('@student.portal')) { renderStudentDashboard(user); }
          } else {
              renderView('role-selection-view');
              const heading = document.getElementById('main-heading');
              if (heading) typeEffect(heading, "Welcome to the Portal");
          }
      });
      document.getElementById('teacher-login-form').addEventListener('submit', async (e) => { e.preventDefault(); toggleButtonSpinner(e.target, true); const email = document.getElementById('teacher-login-email').value; const password = document.getElementById('teacher-login-password').value; try { await signInWithEmailAndPassword(auth, email, password); showNotification('Login successful!', 'success'); } catch (error) { showNotification(error.message, 'error'); } toggleButtonSpinner(e.target, false); });
      document.getElementById('teacher-register-form').addEventListener('submit', async (e) => { e.preventDefault(); toggleButtonSpinner(e.target, true); const email = document.getElementById('teacher-register-email').value; const password = document.getElementById('teacher-register-password').value; try { await createUserWithEmailAndPassword(auth, email, password); showNotification('Teacher account created!', 'success'); } catch (error) { showNotification(error.message, 'error'); } toggleButtonSpinner(e.target, false); });
      document.getElementById('student-login-form').addEventListener('submit', async (e) => { e.preventDefault(); toggleButtonSpinner(e.target, true); const rollNumber = document.getElementById('student-login-roll').value; const password = document.getElementById('student-login-password').value; const email = `${rollNumber}@student.portal`; try { await signInWithEmailAndPassword(auth, email, password); showNotification('Login successful!', 'success'); } catch (error) { showNotification(error.message, 'error'); } toggleButtonSpinner(e.target, false); });
      document.getElementById('student-register-form').addEventListener('submit', async (e) => { e.preventDefault(); toggleButtonSpinner(e.target, true); const name = document.getElementById('student-register-name').value; const rollNumber = document.getElementById('student-register-roll').value; const studentClass = document.getElementById('student-register-class').value; const section = document.getElementById('student-register-section').value; const password = document.getElementById('student-register-password').value; const email = `${rollNumber}@student.portal`; try { const sectionRef = doc(db, "classes", `class${studentClass}`, "sections", section); const sectionSnap = await getDoc(sectionRef); if (!sectionSnap.exists()) { throw new Error("This class/section is not configured yet. Please contact your teacher."); } const sectionData = sectionSnap.data(); const rollNum = parseInt(rollNumber); if (rollNum < sectionData.startRoll || rollNum > sectionData.endRoll) { throw new Error("Your Roll Number is not in the defined range for this section."); } const userCredential = await createUserWithEmailAndPassword(auth, email, password); const user = userCredential.user; await setDoc(doc(db, "students", user.uid), { uid: user.uid, name: name, rollNumber: rollNumber, class: studentClass, section: section, status: 'unverified' }); showNotification('Registration successful! Your account is pending verification.', 'success'); } catch (error) { showNotification(error.message, 'error'); } finally { toggleButtonSpinner(e.target, false); } });
      document.getElementById('teacher-logout-btn').addEventListener('click', () => signOut(auth));
      document.getElementById('student-logout-btn').addEventListener('click', () => signOut(auth));

      // --- DASHBOARD RENDERING ---
      function renderStudentDashboard(user) { const studentDocRef = doc(db, "students", user.uid); const unsub = onSnapshot(studentDocRef, (docSnap) => { if (docSnap.exists()) { const studentData = docSnap.data(); document.getElementById('student-welcome-message').textContent = `Welcome, ${studentData.name}!`; const statusMsg = document.getElementById('student-status-message'); statusMsg.className = 'text-xl p-4 rounded-lg'; if (studentData.status === 'unverified') { statusMsg.textContent = `Your account status is: UNVERIFIED`; statusMsg.classList.add('bg-yellow-500/20', 'text-yellow-300'); } else if (studentData.status === 'verified') { statusMsg.textContent = `Your account status is: VERIFIED`; statusMsg.classList.add('bg-green-500/20', 'text-green-300'); } else if (studentData.status === 'rejected') { statusMsg.textContent = `Your account status is: REJECTED`; statusMsg.classList.add('bg-red-500/20', 'text-red-300'); } else if (studentData.status === 'blocked') { statusMsg.textContent = 'Your account has been BLOCKED. Please contact your teacher.'; statusMsg.classList.add('bg-red-500/20', 'text-red-300'); } renderView('student-dashboard-view'); } else { showNotification('Student data not found!', 'error'); signOut(auth); } }); unsubscribeListeners.push(unsub); }
      function renderTeacherDashboard() { renderView('teacher-dashboard-view'); document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active')); document.querySelector('.nav-btn[data-content="teacher-home-content"]').classList.add('active'); document.querySelectorAll('.teacher-content').forEach(c => c.classList.add('hidden')); document.getElementById('teacher-home-content').classList.remove('hidden'); const q11 = query(collection(db, "students"), where("class", "==", "11"), where("status", "==", "unverified")); const unsub11 = onSnapshot(q11, (snapshot) => { const count = snapshot.size; const dot = document.getElementById('class-11-unverified-count'); dot.textContent = count; dot.classList.toggle('hidden', count === 0); }); unsubscribeListeners.push(unsub11); const q12 = query(collection(db, "students"), where("class", "==", "12"), where("status", "==", "unverified")); const unsub12 = onSnapshot(q12, (snapshot) => { const count = snapshot.size; const dot = document.getElementById('class-12-unverified-count'); dot.textContent = count; dot.classList.toggle('hidden', count === 0); }); unsubscribeListeners.push(unsub12); }

      // --- TEACHER: CLASSES TAB LOGIC ---
      document.getElementById('select-class-11').addEventListener('click', () => showSectionSelection(11));
      document.getElementById('select-class-12').addEventListener('click', () => showSectionSelection(12));
      document.getElementById('back-to-class-selection').addEventListener('click', () => { document.getElementById('section-selection-level').classList.add('hidden'); document.getElementById('class-selection-level').classList.remove('hidden'); currentTeacherClass = null; cleanupListeners(); renderTeacherDashboard(); });
      document.getElementById('back-to-section-selection').addEventListener('click', () => { document.getElementById('student-management-level').classList.add('hidden'); document.getElementById('section-selection-level').classList.remove('hidden'); currentTeacherSection = null; cleanupListeners(); showSectionSelection(currentTeacherClass); });

      function showSectionSelection(classNum) { cleanupListeners(); currentTeacherClass = classNum; document.getElementById('class-selection-level').classList.add('hidden'); document.getElementById('section-selection-level').classList.remove('hidden'); document.getElementById('section-level-title').textContent = `Manage Sections for Class ${classNum}`; const allSections = ['A', 'A1', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J']; const sectionsCollectionRef = collection(db, "classes", `class${classNum}`, "sections"); const unsub = onSnapshot(sectionsCollectionRef, (querySnapshot) => { const sectionGrid = document.getElementById('section-grid'); sectionGrid.innerHTML = ''; const configuredSections = {}; querySnapshot.forEach(doc => { configuredSections[doc.id] = doc.data(); }); allSections.forEach(sectionId => { const sectionData = configuredSections[sectionId]; const card = document.createElement('div'); if (sectionData) { card.className = "bg-gray-800 p-4 rounded-lg neon-glow flex flex-col justify-between items-center text-center cursor-pointer relative"; card.innerHTML = `<div class="absolute top-1 right-1 bg-red-600 text-white text-[10px] font-bold rounded-full h-4 w-4 flex items-center justify-center section-unverified-count" data-section="${sectionId}" style="display: none;">0</div><h4 class="text-2xl font-bold">${sectionId}</h4><p class="text-xs text-gray-400 mt-1">${sectionData.startRoll} - ${sectionData.endRoll}</p><div class="mt-3 flex flex-col space-y-1 w-full text-xs"><button class="modify-range-btn bg-indigo-600/50 hover:bg-indigo-600/80 p-1 rounded w-full">Modify Range</button><button class="delete-section-btn bg-red-600/50 hover:bg-red-600/80 p-1 rounded w-full">Delete</button></div>`; card.addEventListener('click', (e) => { if (e.target.tagName !== 'BUTTON') { showStudentManagement(classNum, sectionId); } }); card.querySelector('.modify-range-btn').addEventListener('click', () => openRollRangeModal(classNum, sectionId, sectionData)); card.querySelector('.delete-section-btn').addEventListener('click', () => deleteSection(classNum, sectionId)); } else { card.className = "bg-gray-800/50 border border-dashed border-gray-600 p-4 rounded-lg flex flex-col justify-center items-center text-center text-gray-500"; card.innerHTML = `<h4 class="text-2xl font-bold">${sectionId}</h4><button class="set-range-btn mt-2 text-indigo-400 text-sm hover:underline">Set Roll Range</button>`; card.querySelector('.set-range-btn').addEventListener('click', () => openRollRangeModal(classNum, sectionId)); } sectionGrid.appendChild(card); }); allSections.forEach(sectionId => { const q = query(collection(db, "students"), where("class", "==", String(classNum)), where("section", "==", sectionId), where("status", "==", "unverified")); const unsubCount = onSnapshot(q, (snapshot) => { const count = snapshot.size; const dot = sectionGrid.querySelector(`.section-unverified-count[data-section="${sectionId}"]`); if (dot) { dot.textContent = count; dot.style.display = count > 0 ? 'flex' : 'none'; } }); unsubscribeListeners.push(unsubCount); }); }); unsubscribeListeners.push(unsub); }
      function showStudentManagement(classNum, sectionId) { cleanupListeners(); currentTeacherSection = sectionId; document.getElementById('section-selection-level').classList.add('hidden'); document.getElementById('student-management-level').classList.remove('hidden'); document.getElementById('student-level-title').textContent = `Students in Class ${classNum} - Section ${sectionId}`; const navContainer = document.getElementById('student-status-nav'); const listsContainer = document.getElementById('student-lists-container'); navContainer.innerHTML = ''; listsContainer.innerHTML = ''; const statuses = ['Unverified', 'Verified', 'Rejected']; statuses.forEach((status, index) => { const navBtn = document.createElement('a'); navBtn.href = '#'; navBtn.dataset.status = status.toLowerCase(); navBtn.className = `whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${index === 0 ? 'border-indigo-500 text-indigo-400' : 'border-transparent text-gray-500 hover:text-gray-300 hover:border-gray-500'}`; navBtn.textContent = status; navContainer.appendChild(navBtn); const listDiv = document.createElement('div'); listDiv.id = `student-list-${status.toLowerCase()}`; listDiv.className = `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 pt-4 ${index > 0 ? 'hidden' : ''}`; listsContainer.appendChild(listDiv); }); navContainer.addEventListener('click', (e) => { if (e.target.tagName === 'A') { e.preventDefault(); const targetStatus = e.target.dataset.status; navContainer.querySelectorAll('a').forEach(btn => { btn.className = 'whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-300 hover:border-gray-500'; }); e.target.className = 'whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-indigo-500 text-indigo-400'; listsContainer.querySelectorAll('div').forEach(list => { list.classList.toggle('hidden', list.id !== `student-list-${targetStatus}`); }); } }); const studentsQuery = query(collection(db, "students"), where("class", "==", String(classNum)), where("section", "==", sectionId)); const unsub = onSnapshot(studentsQuery, (snapshot) => { document.getElementById('student-list-unverified').innerHTML = ''; document.getElementById('student-list-verified').innerHTML = ''; document.getElementById('student-list-rejected').innerHTML = ''; snapshot.forEach(doc => { const student = doc.data(); if (!student.status) return; const studentId = doc.id; const card = document.createElement('div'); card.className = "bg-gray-800 p-4 rounded-lg neon-glow"; card.innerHTML = `<h5 class="font-bold">${student.name}</h5><p class="text-sm text-gray-400">Roll: ${student.rollNumber}</p>`; const actionsDiv = document.createElement('div'); actionsDiv.className = 'mt-3 flex gap-2'; if (student.status === 'unverified') { actionsDiv.innerHTML = `<button data-id="${studentId}" class="approve-btn w-full text-sm bg-green-600 hover:bg-green-700 p-2 rounded">Approve</button><button data-id="${studentId}" class="reject-btn w-full text-sm bg-red-600 hover:bg-red-700 p-2 rounded">Reject</button>`; document.getElementById('student-list-unverified').appendChild(card); } else if (student.status === 'verified') { card.classList.add('cursor-pointer'); card.addEventListener('click', () => showStudentAnalytics(student)); document.getElementById('student-list-verified').appendChild(card); } else if (student.status === 'rejected') { actionsDiv.innerHTML = `<button data-id="${studentId}" class="reapprove-btn w-full text-sm bg-yellow-500 hover:bg-yellow-600 p-2 rounded text-gray-900">Re-Approve</button><button data-id="${studentId}" class="block-btn w-full text-sm bg-slate-600 hover:bg-slate-700 p-2 rounded">Block</button>`; document.getElementById('student-list-rejected').appendChild(card); } card.appendChild(actionsDiv); }); }); unsubscribeListeners.push(unsub); }
      function openRollRangeModal(classNum, sectionId, data = null) { const modal = document.getElementById('roll-range-modal'); document.getElementById('modal-class').value = classNum; document.getElementById('modal-section').value = sectionId; document.getElementById('start-roll').value = data ? data.startRoll : ''; document.getElementById('end-roll').value = data ? data.endRoll : ''; document.getElementById('roll-range-modal-title').textContent = `${data ? 'Modify' : 'Set'} Roll Range for Class ${classNum} - Section ${sectionId}`; modal.classList.remove('hidden'); }
      document.getElementById('cancel-roll-range').addEventListener('click', () => { document.getElementById('roll-range-modal').classList.add('hidden'); });
      document.getElementById('roll-range-form').addEventListener('submit', async (e) => { e.preventDefault(); toggleButtonSpinner(e.target, true); const classNum = document.getElementById('modal-class').value; const sectionId = document.getElementById('modal-section').value; const startRoll = parseInt(document.getElementById('start-roll').value); const endRoll = parseInt(document.getElementById('end-roll').value); if(startRoll >= endRoll) { showNotification('Start Roll must be less than End Roll', 'error'); toggleButtonSpinner(e.target, false); return; } try { const sectionsRef = collection(db, "classes", `class${classNum}`, "sections"); const q = query(sectionsRef, where('__name__', '!=', sectionId)); const querySnapshot = await getDocs(q); let overlaps = false; querySnapshot.forEach((doc) => { const existing = doc.data(); if (Math.max(startRoll, existing.startRoll) <= Math.min(endRoll, existing.endRoll)) { overlaps = true; } }); if (overlaps) { throw new Error("The new range overlaps with an existing section's range."); } await setDoc(doc(db, "classes", `class${classNum}`, "sections", sectionId), { startRoll, endRoll }); showNotification('Roll range saved successfully!', 'success'); document.getElementById('roll-range-modal').classList.add('hidden'); } catch (error) { showNotification(error.message, 'error'); } finally { toggleButtonSpinner(e.target, false); } });
      async function deleteSection(classNum, sectionId) { const confirmation = confirm(`Are you sure? This will permanently delete section ${sectionId} AND all student data within it. This action cannot be undone.`); if (!confirmation) return; try { const batch = writeBatch(db); const sectionRef = doc(db, "classes", `class${classNum}`, "sections", sectionId); batch.delete(sectionRef); const studentsQuery = query(collection(db, "students"), where("class", "==", String(classNum)), where("section", "==", sectionId)); const studentsSnapshot = await getDocs(studentsQuery); if (!studentsSnapshot.empty) { studentsSnapshot.forEach(studentDoc => { batch.delete(studentDoc.ref); }); } await batch.commit(); showNotification(`Section ${sectionId} and its students have been deleted.`, 'success'); } catch (error) { showNotification(`Error deleting section: ${error.message}`, 'error'); } }
            document.getElementById('student-lists-container').addEventListener('click', async (e) => {
                const studentId = e.target.dataset.id;
                if (!studentId) return;
                let newStatus = '';
                let switchToTab = null;
                if (e.target.classList.contains('approve-btn') || e.target.classList.contains('reapprove-btn')) {
                    newStatus = 'verified';
                    switchToTab = 'verified';
                } else if (e.target.classList.contains('reject-btn')) {
                    newStatus = 'rejected';
                    switchToTab = 'rejected';
                } else if (e.target.classList.contains('block-btn')) {
                    if (confirm('Are you sure you want to block this student? They will not be able to use the portal.')) {
                        newStatus = 'blocked';
                        switchToTab = null;
                    }
                }
                if(newStatus) {
                    try {
                        const studentRef = doc(db, "students", studentId);
                        await updateDoc(studentRef, { status: newStatus });
                        showNotification('Student status updated.', 'success');
                        // Switch tab if needed
                        if (switchToTab) {
                            const navContainer = document.getElementById('student-status-nav');
                            const listsContainer = document.getElementById('student-lists-container');
                            navContainer.querySelectorAll('a').forEach(btn => {
                                btn.className = 'whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-300 hover:border-gray-500';
                            });
                            const targetBtn = navContainer.querySelector(`a[data-status="${switchToTab}"]`);
                            if (targetBtn) {
                                targetBtn.className = 'whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-indigo-500 text-indigo-400';
                            }
                            listsContainer.querySelectorAll('div').forEach(list => {
                                list.classList.toggle('hidden', !list.id.endsWith(switchToTab));
                            });
                        }
                    } catch (error) {
                        showNotification('Failed to update status.', 'error');
                    }
                }
            });
      function showStudentAnalytics(student) { const totalGained = Math.floor(Math.random() * 200) + 50; const totalDeducted = Math.floor(Math.random() * 50); const totalMarks = totalGained + totalDeducted; const netScore = totalGained - totalDeducted; const netPercent = totalMarks > 0 ? Math.round((netScore / totalGained) * 100) : 0; document.getElementById('analytics-student-name').textContent = student.name; document.getElementById('analytics-student-roll').textContent = `Class ${student.class} - ${student.section} | Roll: ${student.rollNumber}`; document.getElementById('analytics-quizzes').textContent = Math.floor(Math.random() * 10) + 5; document.getElementById('analytics-gained').textContent = `+${totalGained}`; document.getElementById('analytics-deducted').textContent = `-${totalDeducted}`; document.getElementById('analytics-net-score-percent').textContent = `${netPercent}%`; let rating = 'Poor'; if (netPercent > 85) rating = 'Excellent'; else if (netPercent > 60) rating = 'Good'; document.getElementById('analytics-rating').textContent = rating; const gainedPercent = totalGained > 0 ? (totalGained / (totalGained + totalDeducted)) * 100 : 0; document.getElementById('analytics-graph-gained').style.strokeDasharray = `${gainedPercent}, 100`; document.getElementById('student-analytics-modal').classList.remove('hidden'); }
      document.getElementById('close-analytics-modal').addEventListener('click', () => { document.getElementById('student-analytics-modal').classList.add('hidden'); });
      document.getElementById('select-teacher-btn').addEventListener('click', () => renderView('teacher-auth-view'));
      document.getElementById('select-student-btn').addEventListener('click', () => renderView('student-auth-view'));
      document.querySelectorAll('.back-to-role-selection').forEach(btn => { btn.addEventListener('click', (e) => { e.preventDefault(); renderView('role-selection-view'); }); });
      document.getElementById('show-teacher-register').addEventListener('click', (e) => { e.preventDefault(); document.getElementById('teacher-login-form-container').classList.add('hidden'); document.getElementById('teacher-register-form-container').classList.remove('hidden'); });
      document.getElementById('show-teacher-login').addEventListener('click', (e) => { e.preventDefault(); document.getElementById('teacher-register-form-container').classList.add('hidden'); document.getElementById('teacher-login-form-container').classList.remove('hidden'); });
      document.getElementById('show-student-register').addEventListener('click', (e) => { e.preventDefault(); document.getElementById('student-login-form-container').classList.add('hidden'); document.getElementById('student-register-form-container').classList.remove('hidden'); });
      document.getElementById('show-student-login').addEventListener('click', (e) => { e.preventDefault(); document.getElementById('student-register-form-container').classList.add('hidden'); document.getElementById('student-login-form-container').classList.remove('hidden'); });
      
      // THIS IS THE FIXED NAVIGATION LOGIC
      document.getElementById('teacher-main-nav').addEventListener('click', (e) => {
          if (e.target.classList.contains('nav-btn')) {
              document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
              e.target.classList.add('active');
              
              const currentContent = document.querySelector('.teacher-content:not(.hidden)');
              const newContentId = e.target.dataset.content;

              // If switching away from classes, clean up listeners and reset the view
              if (currentContent && currentContent.id === 'teacher-classes-content' && newContentId !== 'teacher-classes-content') {
                  cleanupListeners();
                  renderTeacherDashboard(); // Re-add base listeners
                  document.getElementById('class-selection-level').classList.remove('hidden');
                  document.getElementById('section-selection-level').classList.add('hidden');
                  document.getElementById('student-management-level').classList.add('hidden');
              }
              
              document.querySelectorAll('.teacher-content').forEach(content => {
                  content.classList.toggle('hidden', content.id !== newContentId);
              });
          }
      });
      
      runParticleAnimation();
    </script>
</body>
</html>

